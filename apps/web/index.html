<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LighthouseIQ - Nursing Layoff Intelligence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <!-- Login Overlay -->
    <div class="login-overlay" id="login-overlay">
      <div class="login-card">
        <div class="login-logo">
          <img src="./LighthouseIQ-login.png" alt="LighthouseIQ" class="logo-img" />
        </div>
        <p class="login-subtitle">Enter your access code to continue</p>
        <form id="login-form">
          <div class="passcode-input-wrapper">
            <input type="password" id="passcode-input" placeholder="Enter passcode" autocomplete="off" maxlength="20" />
          </div>
          <button type="submit" class="btn primary login-btn">Access Dashboard</button>
          <p class="login-error" id="login-error"></p>
        </form>
      </div>
    </div>

    <div class="bg-grid" aria-hidden="true"></div>
    <div class="bg-orb orb-a" aria-hidden="true"></div>
    <div class="bg-orb orb-b" aria-hidden="true"></div>
    <div class="bg-orb orb-c" aria-hidden="true"></div>

    <header class="top-bar">
      <div class="brand">
        <div class="logo">
          <img src="./LighthouseIQ-dashboard.png" alt="LighthouseIQ" class="logo-img" />
        </div>
        <div class="brand-copy">
          <h1>LighthouseIQ: Market Nursing Intelligence</h1>
        </div>
      </div>
      <div class="top-bar-actions">
        <div class="status">
          <span class="status-dot" id="api-dot"></span>
          <span id="api-status">Checking API...</span>
        </div>
        <div class="module-menu">
          <button class="btn ghost small module-btn" id="modules-menu-btn" type="button">Modules v</button>
          <div class="module-dropdown" id="modules-menu">
            <button class="module-item" id="open-programs-module" type="button">
              Accredited Nursing Programs
            </button>
          </div>
        </div>
      </div>
    </header>

    <section class="hero">
      <div class="hero-copy">
        <p class="hero-kicker">Targeted market signals, refreshed in real time.</p>
        <h2>Surface nursing-heavy layoffs before everyone else.</h2>
        <p class="hero-body">
          Filter by state, date, and nursing-impact score to find facilities likely to need
          immediate recruiting support.
        </p>
        <div class="hero-actions">
          <button class="btn primary" id="fetch-btn">Fetch Live Data</button>
          <button class="btn secondary" id="refresh-btn">Refresh Results</button>
          <button class="btn ghost" id="clear-btn">Clear Filters</button>
        </div>

        <!-- Custom Notice Input Section -->
        <div class="custom-notice-section">
          <div class="custom-notice-header">
            <h3>Add Custom Notice</h3>
            <p>Manually add a layoff notice to track</p>
          </div>
          <form id="custom-notice-form" class="custom-notice-form">
            <div class="custom-notice-grid">
              <label>
                Employer Name *
                <input type="text" id="custom-employer" placeholder="e.g., St. Mary's Hospital" required />
              </label>
              <label>
                State *
                <select id="custom-state" required>
                  <option value="">Select state</option>
                </select>
              </label>
              <label>
                Affected Employees
                <input type="number" id="custom-affected" placeholder="e.g., 150" min="1" />
              </label>
              <label>
                Notice Date
                <input type="date" id="custom-date" />
              </label>
              <label>
                Layoff Date
                <input type="date" id="custom-layoff-date" />
              </label>
              <label>
                Location/City
                <input type="text" id="custom-location" placeholder="e.g., Indianapolis, IN" />
              </label>
              <label class="full-width">
                Additional Notes
                <textarea id="custom-notes" placeholder="Any additional details about this layoff..." rows="2"></textarea>
              </label>
            </div>
            <div class="custom-notice-actions">
              <button type="submit" class="btn primary">Add Notice</button>
              <button type="reset" class="btn ghost">Clear Form</button>
            </div>
          </form>
        </div>
      </div>
      <div class="hero-panel">
        <div class="filter-card">
          <div class="filter-header">
            <h3>Signal Controls</h3>
            <p>Dial in the feed recruiters care about.</p>
          </div>
          <div class="filter-grid">
            <label>
              Region
              <select id="filter-region">
                <option value="">All regions</option>
              </select>
            </label>
            <label>
              State(s)
              <div class="multi-select" id="state-multi-select">
                <div class="multi-select-display" id="state-display">
                  <span class="multi-select-placeholder">All states</span>
                </div>
                <div class="multi-select-dropdown" id="state-dropdown">
                  <div class="multi-select-search">
                    <input type="text" id="state-search" placeholder="Search states..." />
                  </div>
                  <div class="multi-select-actions">
                    <button type="button" class="multi-select-action" id="select-all-states">Select All</button>
                    <button type="button" class="multi-select-action" id="clear-all-states">Clear All</button>
                  </div>
                  <div class="multi-select-options" id="state-options">
                    <!-- Options will be populated by JS -->
                  </div>
                </div>
              </div>
              <input type="hidden" id="filter-state" value="" />
            </label>
            <label class="full-width">
              Nursing Specialty
              <div class="multi-select specialty-select" id="specialty-multi-select">
                <div class="multi-select-display" id="specialty-display">
                  <span class="multi-select-placeholder">All specialties</span>
                </div>
                <div class="multi-select-dropdown specialty-dropdown" id="specialty-dropdown">
                  <div class="multi-select-search">
                    <input type="text" id="specialty-search" placeholder="Search specialties (e.g., ICU, OR, Peds)..." />
                  </div>
                  <div class="multi-select-actions">
                    <button type="button" class="multi-select-action" id="select-all-specialties">Select All</button>
                    <button type="button" class="multi-select-action" id="clear-all-specialties">Clear All</button>
                  </div>
                  <div class="multi-select-options specialty-options" id="specialty-options">
                    <!-- Options will be populated by JS with categorized specialties -->
                  </div>
                </div>
              </div>
            </label>
            <label>
              Healthcare org keyword
              <input id="filter-org" type="text" placeholder="e.g., Ascension, HCA, Kaiser" />
            </label>
            <label>
              Since date
              <input id="filter-since" type="date" />
            </label>
            <label>
              Minimum impact score
              <input id="filter-score" type="range" min="0" max="100" value="0" />
              <span class="range-readout" id="score-readout">0+</span>
            </label>
            <label>
              Max results
              <input id="filter-limit" type="number" min="0" max="5000" value="" placeholder="All" />
            </label>
          </div>
        </div>
        <div class="stat-row">
          <div class="stat-card">
            <p class="stat-label">Notices loaded</p>
            <p class="stat-value" id="stat-total">0</p>
          </div>
          <div class="stat-card">
            <p class="stat-label">States active</p>
            <p class="stat-value" id="stat-states">0</p>
          </div>
          <div class="stat-card">
            <p class="stat-label">Last refreshed</p>
            <p class="stat-value small" id="stat-updated">--</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Help Section -->
    <section class="help-section">
      <div class="help-header" id="help-toggle">
        <h3>How to Use This Dashboard</h3>
        <span class="help-toggle-icon">+</span>
      </div>
      <div class="help-content" id="help-content">
        <div class="help-grid">
          <div class="help-card">
            <h4>Signal Controls</h4>
            <p>Filter the layoff notices to find what matters most to your recruiting efforts.</p>
            <dl class="help-list">
              <dt>Region</dt>
              <dd>Filter by US region (Northeast, Midwest, South, West). Selecting a region automatically updates the State dropdown to show only states within that region.</dd>
              <dt>State</dt>
              <dd>Filter by specific state. Shows all 50 states + DC. States with existing notices display their count in parentheses.</dd>
              <dt>Healthcare org keyword</dt>
              <dd>Search for specific healthcare organizations by name (e.g., "Ascension", "HCA", "Kaiser"). Partial matches are supported.</dd>
              <dt>Since date</dt>
              <dd>Show only notices filed on or after this date. Useful for finding recent layoff activity.</dd>
              <dt>Minimum impact score</dt>
              <dd>Filter by nursing impact score (0-100). Higher scores indicate stronger likelihood of nursing staff being affected.</dd>
              <dt>Max results</dt>
              <dd>Limit the number of results displayed (10-500). Default is 100.</dd>
            </dl>
          </div>
          <div class="help-card">
            <h4>Action Buttons</h4>
            <dl class="help-list">
              <dt>Fetch Live Data</dt>
              <dd>Pull the latest WARN notices directly from state databases. Use this to get the most current data.</dd>
              <dt>Refresh Results</dt>
              <dd>Re-apply your current filters to the loaded data without fetching new notices.</dd>
              <dt>Clear Filters</dt>
              <dd>Reset all filters to their default values and show all available notices.</dd>
            </dl>
          </div>
          <div class="help-card">
            <h4>Custom Notices</h4>
            <p>Manually track layoffs that may not appear in official WARN databases yet.</p>
            <dl class="help-list">
              <dt>Employer Name</dt>
              <dd>The name of the healthcare facility or organization (required).</dd>
              <dt>State</dt>
              <dd>The state where the layoff is occurring (required).</dd>
              <dt>Affected Employees</dt>
              <dd>Estimated number of employees affected by the layoff.</dd>
              <dt>Notice/Layoff Dates</dt>
              <dd>When the notice was filed and when layoffs are expected to occur.</dd>
            </dl>
          </div>
          <div class="help-card">
            <h4>Projects</h4>
            <p>Organize notices into projects for tracking recruiting opportunities.</p>
            <dl class="help-list">
              <dt>Create Project</dt>
              <dd>Click "+ New Project" to create a named collection. Add a description and color tag for easy identification.</dd>
              <dt>Save to Project</dt>
              <dd>Click the folder icon on any notice card to save it to one of your projects.</dd>
              <dt>View Project</dt>
              <dd>Click on a project card to see all saved notices and manage the project.</dd>
            </dl>
          </div>
          <div class="help-card">
            <h4>Layoff Weather Map</h4>
            <p>Visual overview of layoff activity across the United States.</p>
            <dl class="help-list">
              <dt>Fog Intensity</dt>
              <dd>Darker shading indicates higher layoff activity in that state. Hover over any state to see the exact count.</dd>
              <dt>State Interaction</dt>
              <dd>Hover over states to see detailed tooltips with the state name and number of nursing-related notices.</dd>
            </dl>
          </div>
          <div class="help-card">
            <h4>Notice Cards</h4>
            <p>Each card in the Recruiter Signal Feed represents a WARN notice.</p>
            <dl class="help-list">
              <dt>Impact Score Badge</dt>
              <dd>Color-coded badge showing nursing impact likelihood. Green = low, yellow = medium, red = high.</dd>
              <dt>Click to Expand</dt>
              <dd>Click any notice card to see full details in the Notice Detail panel on the right.</dd>
              <dt>Save Icon</dt>
              <dd>Click the folder icon to add the notice to a project for tracking.</dd>
            </dl>
          </div>
        </div>
      </div>
    </section>

    <!-- Projects Section -->
    <section class="projects-section">
      <div class="section-header">
        <h3>My Projects</h3>
        <p>Save and organize notices into projects for easy tracking</p>
      </div>
      <div class="projects-container">
        <div class="projects-toolbar">
          <button class="btn primary" id="new-project-btn">+ New Project</button>
          <div class="projects-search">
            <input type="text" id="project-search" placeholder="Search projects..." />
          </div>
        </div>
        <div class="projects-list" id="projects-list">
          <div class="empty-state">No projects yet. Create one to start organizing notices.</div>
        </div>
      </div>

      <!-- New Project Modal -->
      <div class="modal-overlay" id="project-modal">
        <div class="modal-card">
          <div class="modal-header">
            <h3 id="modal-title">Create New Project</h3>
            <button class="modal-close" id="modal-close">&times;</button>
          </div>
          <form id="project-form">
            <div class="modal-body">
              <label>
                Project Name *
                <input type="text" id="project-name" placeholder="e.g., Q1 2026 Midwest Targets" required />
              </label>
              <label>
                Description
                <textarea id="project-description" placeholder="Brief description of this project..." rows="2"></textarea>
              </label>
              <label>
                Color Tag
                <div class="color-picker" id="color-picker">
                  <span class="color-option selected" data-color="#3182ce"></span>
                  <span class="color-option" data-color="#38a169"></span>
                  <span class="color-option" data-color="#d69e2e"></span>
                  <span class="color-option" data-color="#e53e3e"></span>
                  <span class="color-option" data-color="#805ad5"></span>
                  <span class="color-option" data-color="#ed64a6"></span>
                </div>
              </label>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn ghost" id="modal-cancel">Cancel</button>
              <button type="submit" class="btn primary">Save Project</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Project Detail Modal -->
      <div class="modal-overlay" id="project-detail-modal">
        <div class="modal-card modal-large">
          <div class="modal-header">
            <h3 id="project-detail-title">Project Name</h3>
            <button class="modal-close" id="project-detail-close">&times;</button>
          </div>
          <div class="modal-body">
            <p class="project-detail-desc" id="project-detail-desc"></p>
            <div class="project-notices-list" id="project-notices-list">
              <div class="empty-state">No notices saved to this project yet.</div>
            </div>
          </div>
          <div class="modal-footer">
            <div class="modal-footer-left">
              <button type="button" class="btn ghost danger" id="delete-project-btn">Delete Project</button>
            </div>
            <div class="modal-footer-right">
              <button type="button" class="btn ghost" id="export-project-csv">Export CSV</button>
              <button type="button" class="btn ghost" id="export-project-json">Export JSON</button>
              <button type="button" class="btn secondary" id="close-project-detail">Close</button>
            </div>
          </div>
        </div>
      </div>

    </section>

    <section class="weather-map-section">
      <div class="section-header">
        <div class="section-header-text">
          <h3>Layoff Weather Map</h3>
          <p>Fog intensity shows layoff activity by state. Darker = more nursing-related layoffs.</p>
        </div>
        <div class="view-toggle">
          <button class="view-toggle-btn active" id="map-view-btn" title="Map View">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 6v16l7-4 8 4 7-4V2l-7 4-8-4-7 4z"/>
              <path d="M8 2v16"/>
              <path d="M16 6v16"/>
            </svg>
          </button>
          <button class="view-toggle-btn" id="chart-view-btn" title="Bar Chart View">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="12" width="4" height="9"/>
              <rect x="10" y="8" width="4" height="13"/>
              <rect x="17" y="4" width="4" height="17"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="weather-map-container">
        <div class="map-legend" id="map-legend">
          <span class="legend-label">Low activity</span>
          <div class="legend-gradient"></div>
          <span class="legend-label">High activity</span>
        </div>
        <div class="us-map" id="us-map">
          <!-- SVG map will be inserted here by JS -->
        </div>
        <div class="bar-chart-container" id="bar-chart" style="display: none;">
          <!-- Bar chart will be rendered here by JS -->
        </div>
        <div class="map-tooltip" id="map-tooltip"></div>
      </div>
    </section>

    <section class="premium-insights">
      <div class="section-header">
        <div class="section-header-text">
          <h3>Premium Intelligence</h3>
          <p>Early warnings, risk hotspots, and talent opportunity signals.</p>
        </div>
      </div>
      <div class="insight-grid">
        <div class="insight-card">
          <h4>Early-Warning Alerts</h4>
          <p class="insight-subtitle">Recent notices with early signals and short lead times.</p>
          <div class="insight-list" id="alerts-list">
            <div class="empty-state">Loading alerts...</div>
          </div>
        </div>
        <div class="insight-card">
          <h4>Workforce Risk Heatmap</h4>
          <p class="insight-subtitle">Cities with elevated activity in the last 90 days.</p>
          <div class="insight-list" id="heatmap-list">
            <div class="empty-state">Loading hotspots...</div>
          </div>
        </div>
        <div class="insight-card">
          <h4>Talent Opportunity Signals</h4>
          <p class="insight-subtitle">Estimated nurse availability by city.</p>
          <div class="insight-list" id="talent-list">
            <div class="empty-state">Loading opportunities...</div>
          </div>
        </div>
        <div class="insight-card">
          <h4>Employer Behavior Watchlist</h4>
          <p class="insight-subtitle">Systems and facilities with repeated WARN activity.</p>
          <div class="insight-list" id="employer-list">
            <div class="empty-state">Loading employer profiles...</div>
          </div>
        </div>
        <div class="insight-card">
          <h4>Scenario Calculator (Facility Only)</h4>
          <p class="insight-subtitle">Facility-level estimate â€” not region-wide. Use for a single hospital or SNF.</p>
          <div class="forecast-grid">
            <label>
              Beds closed
              <input type="number" id="forecast-beds" min="0" value="30">
              <span class="input-helper">Single facility estimate (not region-wide).</span>
            </label>
            <label>
              Care setting
              <select id="forecast-setting">
                <option value="acute">Acute / Hospital</option>
                <option value="snf">Skilled Nursing / LTC</option>
                <option value="outpatient">Outpatient / Clinic</option>
                <option value="home">Home Health / Hospice</option>
                <option value="behavioral">Behavioral Health</option>
              </select>
              <span class="input-helper">Choose the facility type for staffing mix.</span>
            </label>
            <label>
              Planned horizon (days)
              <input type="number" id="forecast-horizon" min="1" value="60">
              <span class="input-helper">Time window for the facility change.</span>
            </label>
          </div>
          <div class="forecast-output" id="forecast-output">
            Enter inputs to estimate displacement.
          </div>
        </div>
        <div class="insight-card state-calibration">
          <h4>State Calibration (RN Advantage)</h4>
          <p class="insight-subtitle">Compare your state to a target state and get recruiter talking points.</p>
          <div class="calibration-controls">
            <label>
              Recruiter state
              <select id="calibration-home"></select>
            </label>
            <label>
              Target RN state
              <select id="calibration-target"></select>
            </label>
          </div>
          <div class="calibration-score">
            <div>
              <p class="calibration-label">RN State Advantage Score</p>
              <p class="calibration-value" id="calibration-score">--</p>
            </div>
            <div class="calibration-tier" id="calibration-tier">Select states to compare.</div>
          </div>
          <div class="calibration-summary">
            <div>
              <p class="calibration-label">Lead with</p>
              <ul class="calibration-list" id="calibration-top"></ul>
            </div>
            <div>
              <p class="calibration-label">Avoid or reframe</p>
              <ul class="calibration-list" id="calibration-avoid"></ul>
            </div>
          </div>
          <div class="calibration-script" id="calibration-script"></div>
          <div class="calibration-table-wrap">
            <table class="calibration-table">
              <thead>
                <tr>
                  <th>Factor</th>
                  <th>Your State</th>
                  <th>Target State</th>
                  <th>Delta</th>
                </tr>
              </thead>
              <tbody id="calibration-rows"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Strategic Review Section -->
    <section class="strategic-review-section open">
      <div class="strategic-header" id="strategic-toggle">
        <div class="strategic-header-text">
          <h3>Strategic Market Review</h3>
          <p>Executive-level nursing market analysis with salary benchmarks and workforce projections.</p>
        </div>
        <span class="strategic-toggle-icon">-</span>
      </div>
      <div class="strategic-review-content" id="strategic-review-content">
        <!-- Strategic review cards will be rendered here by JS -->
        <div class="empty-state">Loading strategic analysis...</div>
      </div>
    </section>

    <main class="content-grid">
      <section class="results">
        <div class="section-header">
          <h3>Recruiter Signal Feed</h3>
          <p>Ranked by nursing impact and recency.</p>
        </div>
        <div class="search-nav-row">
          <div class="search-bar">
            <input type="text" id="notice-search" placeholder="Search by employer name..." autocomplete="off">
            <button type="button" id="clear-search" class="clear-search-btn" style="display: none;">&times;</button>
          </div>
          <div class="quick-nav" id="quick-nav">
            <button class="quick-nav-btn" id="quick-prev" title="Previous page" disabled>&laquo;</button>
            <span class="quick-nav-info" id="quick-nav-info">Page 1</span>
            <button class="quick-nav-btn" id="quick-next" title="Next page" disabled>&raquo;</button>
          </div>
        </div>
        <div class="notice-list" id="notice-list">
          <div class="empty-state">Loading notices...</div>
        </div>
        <div class="pagination" id="pagination">
          <!-- Pagination controls will be rendered here -->
        </div>
      </section>
      <aside class="detail" id="detail-panel">
        <div class="detail-shell">
          <div class="detail-header">
            <h3>Notice Detail</h3>
            <p>Click a notice to reveal full context.</p>
          </div>
          <div class="detail-body" id="detail-body">
            <div class="empty-detail">No notice selected.</div>
          </div>
        </div>
      </aside>
    </main>

    <footer class="footer">
      <p>Powered by state layoff feeds. Data updated every 6 hours. Score is directional, not a guarantee.</p>
      <a href="./data/metadata.json" target="_blank" rel="noreferrer">Data status</a>
    </footer>

    <!-- Accredited Nursing Programs Modal -->
    <div class="modal-overlay" id="programs-modal">
      <div class="modal-card modal-large">
        <div class="modal-header">
          <h3>Accredited Nursing Programs</h3>
          <button class="modal-close" id="programs-modal-close">&times;</button>
        </div>
        <div class="modal-body programs-modal-body">
          <div class="programs-meta">
            <div class="programs-meta-left">
              <p class="programs-kicker">CCNE + ACEN master list</p>
              <p class="programs-subtitle">Each row is a school-campus-program level.</p>
            </div>
            <div class="programs-meta-right">
              <span id="programs-count">0 programs</span>
              <span id="programs-updated">Last updated --</span>
            </div>
          </div>
          <div class="programs-loading" id="programs-loading">
            <div class="programs-loading-bar">
              <span class="programs-loading-fill" id="programs-progress-bar"></span>
            </div>
            <div class="programs-loading-text" id="programs-progress-text">Loading programs... 0%</div>
          </div>
          <div class="programs-controls">
            <input type="text" id="programs-search" placeholder="Search schools, cities, campuses..." />
            <select id="programs-state-filter">
              <option value="">All states</option>
            </select>
            <select id="programs-level-filter">
              <option value="">All levels</option>
              <option value="ASN">ASN</option>
              <option value="BSN">BSN</option>
              <option value="MSN">MSN</option>
            </select>
          </div>
          <div class="programs-table-wrap">
            <table class="programs-table">
              <thead>
                <tr>
                  <th>Institution</th>
                  <th>Campus</th>
                  <th>City</th>
                  <th>State</th>
                  <th>Level</th>
                  <th>Accreditor</th>
                </tr>
              </thead>
              <tbody id="programs-list">
                <tr>
                  <td colspan="6">Loading programs...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <p class="programs-source-note" id="programs-source-note"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn ghost" id="programs-download">Download CSV</button>
          <button type="button" class="btn secondary" id="programs-close">Close</button>
        </div>
      </div>
    </div>

    <script src="./app-static.js"></script>
  </body>
</html>
